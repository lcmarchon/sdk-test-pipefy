<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Task Manager Pro - Funcional</title>
</head>
<body>
    <div style="padding: 20px; text-align: center;">
        <h2>üöÄ Task Manager Pro - Vers√£o M√≠nima</h2>
        <p>App funcionando sem erros!</p>
    </div>

    <!-- Pipefy Client SDK -->
    <script src="https://s3.amazonaws.com/pipefy-client/pipefy-client.js" async></script>
    <script>
        console.log('üöÄ Iniciando Task Manager Pro - NOVA VERS√ÉO');

        // Fun√ß√£o robusta de inicializa√ß√£o
        function initApp() {
            console.log('üîç Verificando APIs dispon√≠veis...');
            console.log('üîç window.PipefyApp:', typeof window.PipefyApp);
            console.log('üîç Verificando window.xprops:', typeof window.xprops);
            console.log('üîç Verificando PipefyApp global:', typeof PipefyApp);
            
            // Lista todas as poss√≠veis APIs
            const apis = [
                { name: 'window.xprops?.initCall', fn: window.xprops?.initCall },
                { name: 'window.PipefyApp?.initCall', fn: window.PipefyApp?.initCall },
                { name: 'PipefyApp?.initCall', fn: (typeof PipefyApp !== 'undefined' ? PipefyApp.initCall : undefined) },
                { name: 'window.parent.PipefyApp?.initCall', fn: window.parent.PipefyApp?.initCall }
            ];
            
            console.log('üìã APIs encontradas:');
            apis.forEach(api => {
                console.log(`  - ${api.name}: ${typeof api.fn}`);
            });
            
            // Procura por qualquer API v√°lida
            const validApi = apis.find(api => typeof api.fn === 'function');
            
            if (!validApi) {
                console.error('‚ùå Nenhuma API de inicializa√ß√£o encontrada');
                console.log('üîç Tentando novamente em 2 segundos...');
                setTimeout(initApp, 2000);
                return;
            }
            
            console.log(`‚úÖ Usando API: ${validApi.name}`);
            
            try {
                validApi.fn({
                    'card-buttons': function(p, card) {
                        console.log('üé¥ Card buttons chamado');
                        return [
                            {
                                icon: 'https://cdn.jsdelivr.net/gh/twitter/twemoji@latest/assets/svg/1f4dd.svg',
                                text: 'Notas',
                                callback: function(p) {
                                    console.log('‚úÖ Notas clicado');
                                    alert('üìù Notas funcionando!');
                                }
                            },
                            {
                                icon: 'https://cdn.jsdelivr.net/gh/twitter/twemoji@latest/assets/svg/23f1.svg',
                                text: 'Timer',
                                callback: function(p) {
                                    console.log('‚úÖ Timer clicado');
                                    alert('‚è±Ô∏è Timer funcionando!');
                                }
                            }
                        ];
                    },
                
                    'card-tab': function(p, card) {
                        console.log('üéØ Card tab chamado! NOVA VERS√ÉO');
                        console.log('üìã Card:', card);
                        
                        return {
                            icon: 'https://cdn.icon-icons.com/icons2/2428/PNG/512/whatsapp_logo_icon_147205.png',
                            label: 'WhatsApp',
                            url: './whatsapp-tab.html'
                        };
                    }
                });
                
                console.log('‚úÖ App inicializado com sucesso!');
                
            } catch (error) {
                console.error('‚ùå Erro na inicializa√ß√£o:', error);
            }
        }
        
        // Estrat√©gia robusta de inicializa√ß√£o
        let attempts = 0;
        const maxAttempts = 10;
        
        function tryInit() {
            attempts++;
            console.log(`üîÑ Tentativa ${attempts}/${maxAttempts} de inicializa√ß√£o`);
            
            if (attempts >= maxAttempts) {
                console.error('‚ùå M√°ximo de tentativas atingido');
                return;
            }
            
            initApp();
        }
        
        // M√∫ltiplas formas de inicializa√ß√£o
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', tryInit);
        } else {
            tryInit();
        }
        
        // Tentativas adicionais
        setTimeout(tryInit, 500);
        setTimeout(tryInit, 1000);
        setTimeout(tryInit, 2000);
        setTimeout(tryInit, 5000);
        
        // Event listener para quando a SDK carregar
        window.addEventListener('load', function() {
            console.log('üîÑ Window loaded, tentando inicializa√ß√£o...');
            setTimeout(tryInit, 100);
        });
        
        // Intercepta poss√≠veis erros de script
        window.addEventListener('error', function(e) {
            console.error('‚ùå Erro de script:', e.error);
        });
        
        console.log('üìã Sistema de inicializa√ß√£o configurado');
    </script>
</body>
</html>
                    
                    try {
                        const config = {
                            icon: 'https://cdn.icon-icons.com/icons2/2428/PNG/512/whatsapp_logo_icon_147205.png',
                            label: 'WhatsApp',
                            url: './whatsapp-tab.html'
                        };
                        
                        console.log('‚úÖ Config da aba:', config);
                        return config;
                        
                    } catch (error) {
                        console.error('‚ùå Erro no card-tab:', error);
                        return null;
                    }
                }
            });
        }
        
        // Inicializa√ß√£o com m√∫ltiplos fallbacks
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function() {
                setTimeout(initApp, 100);
            });
        } else {
            setTimeout(initApp, 100);
        }
        
        // Fallback adicional
        setTimeout(initApp, 500);
        setTimeout(initApp, 1000);
    </script>
</body>
            // APENAS CARD BUTTONS - vers√£o super simplificada
            'card-buttons': function(p, pipe, card) {
                console.log('üé® Bot√µes b√°sicos no card');
                return [
                    {
                        icon: 'https://cdn.jsdelivr.net/gh/twitter/twemoji@latest/assets/svg/1f4dd.svg',
                        text: 'Notas',
                        callback: function(p) {
                            console.log('‚úÖ Notas clicado');
                            alert('üìù Notas funcionando!');
                        }
                    },
                    {
                        icon: 'https://cdn.jsdelivr.net/gh/twitter/twemoji@latest/assets/svg/23f1.svg',
                        text: 'Timer',
                        callback: function(p) {
                            console.log('‚úÖ Timer clicado');
                            alert('‚è±Ô∏è Timer funcionando!');
                        }
                    }
                ];
            },
            
            // DEBUG: ABA WHATSAPP NO CARD (vers√£o simplificada)
            'card-tab': function(p, card) {
                console.log('üéØ Card tab chamado! Vers√£o DEBUG');
                console.log('üìã Card recebido:', card);
                console.log('üéØ Card tab chamado!');
                
                try {
                    // Objeto super simples para teste
                    const tabConfig = {
                        icon: 'https://cdn.icon-icons.com/icons2/2428/PNG/512/whatsapp_logo_icon_147205.png',
                        label: 'WhatsApp',
                        url: './whatsapp-tab.html'
                    };
                    
                    console.log('‚úÖ Retornando config simples:', tabConfig);
                    return tabConfig;
                    
                } catch (error) {
                    console.error('‚ùå Erro no card-tab:', error);
                    return {
                        icon: 'https://cdn.icon-icons.com/icons2/2428/PNG/512/whatsapp_logo_icon_147205.png',
                        label: 'Debug',
                        url: './whatsapp-tab.html'
                    };
                }
            }
        });

        console.log('‚úÖ App configurado - aguardando card-tab...');
    </script>
</body>
</html>